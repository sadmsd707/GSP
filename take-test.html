<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Tests - Soham Student Dashboard</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: #f5f7fa;
      color: #333;
      line-height: 1.6;
      overflow-x: hidden;
    }

    header {
      background: #2563eb;
      color: white;
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      position: relative;
      z-index: 100;
    }

    header h1 {
      font-size: 1.8rem;
      font-weight: 700;
    }

    .student-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .student-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    /* Hamburger Menu Styles */
    .hamburger {
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      width: 30px;
      height: 21px;
      padding: 0;
    }

    .hamburger span {
      display: block;
      height: 3px;
      width: 100%;
      background-color: white;
      border-radius: 3px;
      transition: all 0.3s ease;
    }

    /* Side Navigation Panel */
    .side-nav {
      position: fixed;
      top: 0;
      right: -300px;
      width: 300px;
      height: 100vh;
      background: linear-gradient(to bottom, #2563eb, #1e3a8a);
      box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
      transition: right 0.4s ease;
      z-index: 1000;
      padding-top: 70px;
    }

    .side-nav.active {
      right: 0;
    }

    .side-nav ul {
      list-style: none;
      padding: 0;
    }

    .side-nav ul li {
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .side-nav ul li a {
      display: block;
      color: white;
      text-decoration: none;
      padding: 15px 30px;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .side-nav ul li a:hover {
      background-color: rgba(255, 255, 255, 0.1);
      padding-left: 40px;
    }

    .nav-icon {
      font-size: 1.2rem;
      width: 20px;
      text-align: center;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .overlay.active {
      opacity: 1;
      visibility: visible;
    }

    /* Dashboard Styles */
    .dashboard {
      padding: 30px 20px;
      max-width: 1200px;
      margin: auto;
    }

    .welcome-section {
      background: linear-gradient(to right, #2563eb, #1e3a8a);
      color: white;
      padding: 30px;
      border-radius: 15px;
      margin-bottom: 30px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
    }

    .welcome-section::before {
      content: "";
      position: absolute;
      top: -50%;
      right: -50%;
      width: 100%;
      height: 200%;
      background: rgba(255, 255, 255, 0.1);
      transform: rotate(30deg);
    }

    .welcome-section h2 {
      font-size: 2.2rem;
      margin-bottom: 10px;
      position: relative;
    }

    .welcome-section p {
      font-size: 1.2rem;
      opacity: 0.9;
      position: relative;
    }

    .dashboard-section {
      background: white;
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    }

    .dashboard-section h3 {
      color: #1e3a8a;
      margin-bottom: 25px;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Test Cards */
    .tests-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }

    .test-card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.08);
      border-top: 4px solid #2563eb;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .test-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .test-card.upcoming {
      border-top-color: #f59e0b;
    }

    .test-card.completed {
      border-top-color: #6b7280;
      opacity: 0.8;
    }

    .test-card.ongoing {
      border-top-color: #ef4444;
    }

    .test-status {
      position: absolute;
      top: 15px;
      right: 15px;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .status-upcoming {
      background: #fef3c7;
      color: #d97706;
    }

    .status-ongoing {
      background: #fee2e2;
      color: #dc2626;
    }

    .status-completed {
      background: #e5e7eb;
      color: #6b7280;
    }

    .test-header {
      margin-bottom: 15px;
      padding-right: 80px;
    }

    .test-header h4 {
      color: #1e3a8a;
      font-size: 1.3rem;
      margin-bottom: 5px;
    }

    .test-subject {
      color: #2563eb;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .test-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }

    .test-detail {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .detail-label {
      font-size: 0.8rem;
      color: #6b7280;
      font-weight: 600;
    }

    .detail-value {
      font-size: 0.95rem;
      color: #1f2937;
      font-weight: 500;
    }

    .test-actions {
      display: flex;
      gap: 10px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      text-decoration: none;
    }

    .btn-primary {
      background: #2563eb;
      color: white;
    }

    .btn-primary:hover {
      background: #1e3a8a;
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: #f59e0b;
      color: white;
    }

    .btn-secondary:hover {
      background: #d97706;
      transform: translateY(-2px);
    }

    .btn-outline {
      background: transparent;
      border: 1px solid #2563eb;
      color: #2563eb;
    }

    .btn-outline:hover {
      background: #2563eb;
      color: white;
    }

    .btn-disabled {
      background: #e5e7eb;
      color: #9ca3af;
      cursor: not-allowed;
    }

    .btn-disabled:hover {
      transform: none;
    }

    /* Filter Section */
    .filter-section {
      background: #f8fafc;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 25px;
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .filter-label {
      font-size: 0.9rem;
      color: #374151;
      font-weight: 600;
    }

    .filter-select {
      padding: 10px 15px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      background: white;
      font-size: 0.9rem;
      min-width: 150px;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #64748b;
    }

    .empty-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      opacity: 0.5;
    }

    .empty-state h4 {
      color: #475569;
      margin-bottom: 10px;
    }

    /* Test Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 15px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    }

    .modal-header {
      background: #2563eb;
      color: white;
      padding: 20px;
      border-radius: 15px 15px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h3 {
      margin: 0;
      font-size: 1.5rem;
    }

    .close-modal {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 5px;
    }

    .modal-body {
      padding: 30px;
    }

    .test-instructions {
      background: #f0f9ff;
      border: 1px solid #bae6fd;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 25px;
    }

    .test-instructions h4 {
      color: #1e3a8a;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .instructions-list {
      list-style: none;
      padding: 0;
    }

    .instructions-list li {
      padding: 8px 0;
      border-bottom: 1px solid #e0f2fe;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .instructions-list li:last-child {
      border-bottom: none;
    }

    .instructions-list .icon {
      color: #2563eb;
      font-weight: bold;
    }

    /* Loading animation */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    footer {
      background: #1e3a8a;
      color: white;
      text-align: center;
      padding: 30px;
      margin-top: 50px;
    }

    footer p {
      font-size: 1rem;
    }

    /* New styles for enhanced features */
    
    /* Test progress indicator */
    .test-progress {
      margin-top: 15px;
    }
    
    .progress-bar {
      height: 8px;
      background: #e5e7eb;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 5px;
    }
    
    .progress-fill {
      height: 100%;
      background: #2563eb;
      border-radius: 4px;
      transition: width 0.5s ease;
    }
    
    .progress-text {
      font-size: 0.8rem;
      color: #6b7280;
      display: flex;
      justify-content: space-between;
    }
    
    /* Search functionality */
    .search-container {
      position: relative;
      margin-bottom: 20px;
    }
    
    .search-input {
      width: 100%;
      padding: 12px 45px 12px 15px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    
    .search-input:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    
    .search-icon {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #6b7280;
    }
    
    /* Test difficulty indicators */
    .difficulty {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-top: 5px;
    }
    
    .difficulty-easy {
      background: #d1fae5;
      color: #065f46;
    }
    
    .difficulty-medium {
      background: #fef3c7;
      color: #92400e;
    }
    
    .difficulty-hard {
      background: #fee2e2;
      color: #991b1b;
    }
    
    /* Test statistics */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      text-align: center;
      border-top: 4px solid #2563eb;
    }
    
    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: #2563eb;
      margin-bottom: 5px;
    }
    
    .stat-label {
      font-size: 0.9rem;
      color: #6b7280;
    }
    
    /* Notification badge */
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ef4444;
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 0.7rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* Refresh button */
    .refresh-btn {
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 15px;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
    }
    
    .refresh-btn:hover {
      background: #2563eb;
      transform: translateY(-2px);
    }
    
    /* Loading overlay */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.8);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2001;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .loading-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid #e5e7eb;
      border-top: 5px solid #2563eb;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }
    
    /* Responsive styles */
    @media (max-width: 768px) {
      header {
        padding: 15px 20px;
      }
      
      .welcome-section h2 {
        font-size: 1.8rem;
      }
      
      .welcome-section p {
        font-size: 1rem;
      }
      
      .tests-container {
        grid-template-columns: 1fr;
      }
      
      .test-details {
        grid-template-columns: 1fr;
      }
      
      .filter-section {
        flex-direction: column;
        align-items: stretch;
      }
      
      .test-actions {
        flex-direction: column;
      }
      
      .stats-container {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    @media (max-width: 480px) {
      .stats-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Soham - Student Dashboard</h1>
    <div class="student-info">
        <div class="notification-badge" id="notificationBadge" style="display: none;">3</div>
    <button class="hamburger" id="hamburger">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </header>

  <!-- Side Navigation -->
  <div class="side-nav" id="sideNav">
    <ul>
       <li><a href="student-dashboard.html">Home</a></li>
      <li><a href="take-test.html">Take a Test</a></li>
      <li><a href="exam.html">Practice</a></li>
      <li><a href="scores.html">Scores</a></li>
      <li><a href="announcements.html">Announcements</a></li> <!-- Added Announcements option -->
      <li><a href="student-resources.html" onclick="logout()">Resources</a></li>
      <li><a href="board-prep.html">Board Preparation</a></li>
      <li><a href="student-account.html">My Account</a></li>
      <li><a href="role-selection.html" onclick="logout()">Logout</a></li>
    </ul>
  </div>

  <!-- Overlay for closing the menu when clicking outside -->
  <div class="overlay" id="overlay"></div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <p>Loading tests from teachers...</p>
  </div>

  <!-- Test Instructions Modal -->
  <div class="modal" id="testInstructionsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Test Instructions</h3>
        <button class="close-modal" onclick="closeTestInstructions()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="test-instructions">
          <h4><span>üìã</span> Important Instructions</h4>
          <ul class="instructions-list" id="instructionsList">
            <!-- Instructions will be populated by JavaScript -->
          </ul>
        </div>
        <div class="test-actions" style="justify-content: center; margin-top: 25px;">
          <button class="btn btn-primary" onclick="startTest()">
            <span>Start Test</span>
          </button>
          <button class="btn btn-outline" onclick="closeTestInstructions()">
            <span>Cancel</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <main class="dashboard">
    <section class="welcome-section">
      <h2>My Tests</h2>
      <p>View and take tests assigned by your teachers</p>
    </section>

    <!-- Test Statistics -->
    <div class="stats-container">
      <div class="stat-card">
        <div class="stat-value" id="totalTests">0</div>
        <div class="stat-label">Total Tests</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="upcomingTests">0</div>
        <div class="stat-label">Upcoming</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="completedTests">0</div>
        <div class="stat-label">Completed</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="averageScore">0%</div>
        <div class="stat-label">Average Score</div>
      </div>
    </div>

    <div class="dashboard-section">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h3><span class="icon">üìù</span> Tests from Teachers</h3>
        <button class="refresh-btn" onclick="fetchTestsFromTeachers()">
          <span>üîÑ</span> Refresh Tests
        </button>
      </div>
      
      <!-- Search and View Toggle -->
      <div class="search-container">
        <input type="text" class="search-input" id="searchInput" placeholder="Search tests by name, subject, or teacher..." onkeyup="searchTests()">
        <span class="search-icon">üîç</span>
      </div>
      
      <!-- Filter Section -->
      <div class="filter-section">
        <div class="filter-group">
          <label class="filter-label">Filter by Status</label>
          <select class="filter-select" id="statusFilter" onchange="filterTests()">
            <option value="all">All Tests</option>
            <option value="upcoming">Upcoming</option>
            <option value="ongoing">Ongoing</option>
            <option value="completed">Completed</option>
          </select>
        </div>
        <div class="filter-group">
          <label class="filter-label">Filter by Subject</label>
          <select class="filter-select" id="subjectFilter" onchange="filterTests()">
            <option value="all">All Subjects</option>
            <option value="physics">Physics</option>
            <option value="chemistry">Chemistry</option>
            <option value="mathematics">Mathematics</option>
            <option value="biology">Biology</option>
            <option value="english">English</option>
            <option value="history">History</option>
          </select>
        </div>
        <div class="filter-group">
          <label class="filter-label">Sort by</label>
          <select class="filter-select" id="sortFilter" onchange="filterTests()">
            <option value="date">Due Date</option>
            <option value="name">Test Name</option>
            <option value="subject">Subject</option>
            <option value="difficulty">Difficulty</option>
          </select>
        </div>
      </div>

      <!-- Tests Container -->
      <div class="tests-container" id="testsContainer">
        <!-- Test cards will be populated by JavaScript -->
      </div>

      <div class="empty-state" id="emptyState" style="display: none;">
        <div class="empty-icon">üìù</div>
        <h4>No tests available</h4>
        <p>You don't have any tests assigned yet. Check back later for new assignments.</p>
      </div>
    </div>
  </main>

  <footer>
    <p>&copy; 2026 Soham - Entrance Exam Practice. All rights reserved.</p>
     <p style="margin-top: 10px; font-size: 0.9rem;">Made with ‚ù§Ô∏è by Team Soham</p>
  </footer>

  <script>
    // Check if user is logged in and is a student
    if (localStorage.getItem("isLoggedIn") !== "true" || localStorage.getItem("userRole") !== "student") {
      window.location.href = "role-selection.html";
    }

    // Load student data
    function loadStudentData() {
      const studentName = localStorage.getItem('userName') || 'Student';
      const studentId = localStorage.getItem('userId') || '';
      
      document.getElementById('studentName').textContent = studentName;
      
      // Create avatar from name initials
      const initials = studentName.split(' ').map(n => n[0]).join('').toUpperCase();
      document.getElementById('studentAvatar').textContent = initials;
    }

    // Fetch tests created by teachers
    function fetchTestsFromTeachers() {
      // Show loading overlay
      document.getElementById('loadingOverlay').classList.add('active');
      
      // Simulate API call delay
      setTimeout(() => {
        // Get tests from localStorage (created by teachers)
        const teacherTests = JSON.parse(localStorage.getItem('tests')) || [];
        
        // Transform teacher-created tests to student format
        const studentTests = teacherTests.map(test => {
          // Determine test status based on date
          const now = new Date();
          const testDate = new Date(test.testDate);
          const status = determineTestStatus(testDate, test.testId);
          
          // Generate instructions based on test data
          const instructions = generateInstructions(test);
          
          // Calculate difficulty based on subject and marks
          const difficulty = calculateDifficulty(test);
          
          return {
            id: test.testId,
            name: test.testTitle,
            subject: extractSubject(test.testTitle) || 'general',
            teacher: extractTeacher(test.testClass) || 'Teacher',
            duration: `${test.testDuration} minutes`,
            questions: test.numberOfQuestions,
            totalMarks: test.totalMarks,
            dueDate: test.testDate,
            status: status,
            difficulty: difficulty,
            progress: getTestProgress(test.testId),
            instructions: instructions,
            createdBy: 'teacher',
            teacherId: 'teacher_' + Math.floor(Math.random() * 1000)
          };
        });
        
        // Store tests in localStorage for student
        localStorage.setItem('studentTests', JSON.stringify(studentTests));
        
        // Hide loading overlay
        document.getElementById('loadingOverlay').classList.remove('active');
        
        // Display the tests
        displayTests(studentTests);
        updateTestStatistics(studentTests);
        
        // Show success message
        showSuccessMessage('Successfully fetched latest tests from your teachers!');
      }, 1500);
    }

    // Determine test status based on date and student progress
    function determineTestStatus(testDate, testId) {
      const now = new Date();
      const testDateTime = new Date(testDate);
      
      // Check if test is completed
      const studentProgress = JSON.parse(localStorage.getItem('studentProgress')) || {};
      if (studentProgress[testId] && studentProgress[testId].completed) {
        return 'completed';
      }
      
      // Check if test is ongoing (student has started but not completed)
      if (studentProgress[testId] && studentProgress[testId].started && !studentProgress[testId].completed) {
        return 'ongoing';
      }
      
      // Check if test date is in the future
      if (testDateTime > now) {
        return 'upcoming';
      }
      
      // Default to upcoming if no other status applies
      return 'upcoming';
    }

    // Generate instructions based on test data
    function generateInstructions(test) {
      const instructions = [
        `Total time allowed: ${test.testDuration} minutes`,
        `There are ${test.numberOfQuestions} questions`,
        `Total marks: ${test.totalMarks}`,
        'Read each question carefully before answering',
        'Manage your time wisely',
        test.instructions || 'Follow all instructions provided by your teacher'
      ];
      
      return instructions;
    }

    // Calculate difficulty based on subject and marks
    function calculateDifficulty(test) {
      // Simple difficulty calculation based on subject and question count
      const subject = extractSubject(test.testTitle);
      const questionCount = parseInt(test.numberOfQuestions);
      const duration = parseInt(test.testDuration);
      
      if (subject === 'mathematics' || subject === 'physics') {
        return questionCount > 25 ? 'hard' : (questionCount > 15 ? 'medium' : 'easy');
      } else {
        return duration > 60 ? 'hard' : (duration > 30 ? 'medium' : 'easy');
      }
    }

    // Extract subject from test title
    function extractSubject(title) {
      const subjects = ['physics', 'chemistry', 'mathematics', 'biology', 'english', 'history'];
      const lowerTitle = title.toLowerCase();
      
      for (const subject of subjects) {
        if (lowerTitle.includes(subject)) {
          return subject;
        }
      }
      
      return 'general';
    }

    // Extract teacher name from class
    function extractTeacher(className) {
      // This would typically come from a teacher database
      const teacherMap = {
        '11th-mhtcet-pcm': 'Dr. Sharma',
        '11th-mhtcet-pcb': 'Ms. Patel',
        '11th-jee': 'Mr. Kumar',
        '11th-neet': 'Dr. Gupta',
        '12th-mhtcet-pcm': 'Dr. Sharma',
        '12th-mhtcet-pcb': 'Ms. Patel',
        '12th-jee': 'Mr. Kumar',
        '12th-neet': 'Dr. Gupta'
      };
      
      return teacherMap[className] || 'Teacher';
    }

    // Get test progress for a student
    function getTestProgress(testId) {
      const studentProgress = JSON.parse(localStorage.getItem('studentProgress')) || {};
      if (studentProgress[testId]) {
        return studentProgress[testId].progress || 0;
      }
      return 0;
    }

    // Current test to start
    let currentTest = null;
    let allTests = [];

    // Logout function
    function logout() {
      const logoutBtn = event.target;
      const originalText = logoutBtn.innerHTML;
      logoutBtn.innerHTML = '<span class="loading"></span> Logging out...';
      logoutBtn.disabled = true;
      
      setTimeout(() => {
        localStorage.removeItem("isLoggedIn");
        localStorage.removeItem("userRole");
        localStorage.removeItem("userId");
        localStorage.removeItem("userName");
        window.location.href = "login.html";
      }, 1000);
    }

    // Hamburger menu functionality
    const hamburger = document.getElementById('hamburger');
    const sideNav = document.getElementById('sideNav');
    const overlay = document.getElementById('overlay');

    hamburger.addEventListener('click', () => {
      sideNav.classList.toggle('active');
      overlay.classList.toggle('active');
      document.body.style.overflow = sideNav.classList.contains('active') ? 'hidden' : 'auto';
    });

    overlay.addEventListener('click', () => {
      sideNav.classList.remove('active');
      overlay.classList.remove('active');
      document.body.style.overflow = 'auto';
    });

    // Close menu when clicking on a link
    const navLinks = document.querySelectorAll('.side-nav a');
    navLinks.forEach(link => {
      link.addEventListener('click', () => {
        sideNav.classList.remove('active');
        overlay.classList.remove('active');
        document.body.style.overflow = 'auto';
      });
    });

    // Format date for display
    function formatDate(dateString) {
      const options = { 
        weekday: 'short', 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      };
      return new Date(dateString).toLocaleDateString('en-US', options);
    }

    // Format time remaining
    function getTimeRemaining(dueDate) {
      const now = new Date();
      const due = new Date(dueDate);
      const diff = due - now;
      
      if (diff <= 0) return 'Expired';
      
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      
      if (days > 0) return `${days}d ${hours}h left`;
      if (hours > 0) return `${hours}h left`;
      
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      return `${minutes}m left`;
    }

    // Calculate and display test statistics
    function updateTestStatistics(tests) {
      const totalTests = tests.length;
      const upcomingTests = tests.filter(test => test.status === 'upcoming').length;
      const completedTests = tests.filter(test => test.status === 'completed').length;
      
      // Calculate average score
      const studentProgress = JSON.parse(localStorage.getItem('studentProgress')) || {};
      let totalScore = 0;
      let scoredTests = 0;
      
      tests.forEach(test => {
        if (studentProgress[test.id] && studentProgress[test.id].score) {
          totalScore += studentProgress[test.id].score;
          scoredTests++;
        }
      });
      
      const averageScore = scoredTests > 0 ? Math.round(totalScore / scoredTests) : 0;
      
      document.getElementById('totalTests').textContent = totalTests;
      document.getElementById('upcomingTests').textContent = upcomingTests;
      document.getElementById('completedTests').textContent = completedTests;
      document.getElementById('averageScore').textContent = `${averageScore}%`;
      
      // Show notification badge if there are upcoming tests
      const notificationBadge = document.getElementById('notificationBadge');
      if (upcomingTests > 0) {
        notificationBadge.textContent = upcomingTests;
        notificationBadge.style.display = 'flex';
      } else {
        notificationBadge.style.display = 'none';
      }
    }

    // Display tests in list view
    function displayTests(tests) {
      allTests = tests;
      const container = document.getElementById('testsContainer');
      const emptyState = document.getElementById('emptyState');
      
      if (tests.length === 0) {
        container.innerHTML = '';
        emptyState.style.display = 'block';
        return;
      }
      
      emptyState.style.display = 'none';
      
      let html = '';
      tests.forEach(test => {
        const statusClass = `status-${test.status}`;
        const cardClass = `test-card ${test.status}`;
        const timeRemaining = getTimeRemaining(test.dueDate);
        const difficultyClass = `difficulty-${test.difficulty}`;
        
        // Get student progress data
        const studentProgress = JSON.parse(localStorage.getItem('studentProgress')) || {};
        const testProgress = studentProgress[test.id] || {};
        
        html += `
          <div class="${cardClass}">
            <div class="test-status ${statusClass}">${test.status}</div>
            <div class="test-header">
              <h4>${test.name}</h4>
              <div class="test-subject">${test.subject.charAt(0).toUpperCase() + test.subject.slice(1)} ‚Ä¢ ${test.teacher}</div>
              <div class="difficulty ${difficultyClass}">${test.difficulty.charAt(0).toUpperCase() + test.difficulty.slice(1)}</div>
            </div>
            <div class="test-details">
              <div class="test-detail">
                <span class="detail-label">Duration</span>
                <span class="detail-value">${test.duration}</span>
              </div>
              <div class="test-detail">
                <span class="detail-label">Questions</span>
                <span class="detail-value">${test.questions}</span>
              </div>
              <div class="test-detail">
                <span class="detail-label">Total Marks</span>
                <span class="detail-value">${test.totalMarks}</span>
              </div>
              <div class="test-detail">
                <span class="detail-label">Due Date</span>
                <span class="detail-value">${formatDate(test.dueDate)}</span>
              </div>
            </div>
            ${test.status === 'completed' ? `
              <div class="test-detail">
                <span class="detail-label">Your Score</span>
                <span class="detail-value" style="color: #2563eb; font-weight: bold;">
                  ${testProgress.score || 0}/${test.totalMarks} (${Math.round(((testProgress.score || 0)/test.totalMarks)*100)}%)
                </span>
              </div>
            ` : `
              <div class="test-detail">
                <span class="detail-label">Time Remaining</span>
                <span class="detail-value" style="color: ${test.status === 'ongoing' ? '#ef4444' : '#f59e0b'}; font-weight: bold;">
                  ${timeRemaining}
                </span>
              </div>
            `}
            ${test.progress > 0 && test.status !== 'completed' ? `
              <div class="test-progress">
                <div class="progress-bar">
                  <div class="progress-fill" style="width: ${test.progress}%"></div>
                </div>
                <div class="progress-text">
                  <span>Progress</span>
                  <span>${test.progress}%</span>
                </div>
              </div>
            ` : ''}
            <div class="test-actions">
              ${test.status === 'upcoming' ? `
                <button class="btn btn-outline" onclick="viewTestDetails('${test.id}')">
                  <span>View Details</span>
                </button>
              ` : test.status === 'ongoing' ? `
                <button class="btn btn-primary" onclick="showTestInstructions('${test.id}')">
                  <span>Continue Test</span>
                </button>
                <button class="btn btn-outline" onclick="viewTestDetails('${test.id}')">
                  <span>Details</span>
                </button>
              ` : `
                <button class="btn btn-secondary" onclick="viewResults('${test.id}')">
                  <span>View Results</span>
                </button>
                <button class="btn btn-outline" onclick="reviewTest('${test.id}')">
                  <span>Review</span>
                </button>
              `}
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html;
    }

    // Search tests
    function searchTests() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      
      let filteredTests = [...allTests];
      
      // Apply search filter
      if (searchTerm) {
        filteredTests = filteredTests.filter(test => 
          test.name.toLowerCase().includes(searchTerm) ||
          test.subject.toLowerCase().includes(searchTerm) ||
          test.teacher.toLowerCase().includes(searchTerm)
        );
      }
      
      // Apply other filters
      filteredTests = applyFilters(filteredTests);
      
      // Update display
      displayTests(filteredTests);
      updateTestStatistics(filteredTests);
    }

    // Apply filters to tests
    function applyFilters(tests) {
      const statusFilter = document.getElementById('statusFilter').value;
      const subjectFilter = document.getElementById('subjectFilter').value;
      const sortFilter = document.getElementById('sortFilter').value;
      
      let filteredTests = [...tests];
      
      // Apply status filter
      if (statusFilter !== 'all') {
        filteredTests = filteredTests.filter(test => test.status === statusFilter);
      }
      
      // Apply subject filter
      if (subjectFilter !== 'all') {
        filteredTests = filteredTests.filter(test => test.subject === subjectFilter);
      }
      
      // Apply sorting
      filteredTests.sort((a, b) => {
        if (sortFilter === 'date') {
          return new Date(a.dueDate) - new Date(b.dueDate);
        } else if (sortFilter === 'name') {
          return a.name.localeCompare(b.name);
        } else if (sortFilter === 'subject') {
          return a.subject.localeCompare(b.subject);
        } else if (sortFilter === 'difficulty') {
          const difficultyOrder = { 'easy': 1, 'medium': 2, 'hard': 3 };
          return difficultyOrder[a.difficulty] - difficultyOrder[b.difficulty];
        }
        return 0;
      });
      
      return filteredTests;
    }

    // Filter tests
    function filterTests() {
      const filteredTests = applyFilters(allTests);
      displayTests(filteredTests);
      updateTestStatistics(filteredTests);
    }

    // Show test instructions
    function showTestInstructions(testId) {
      currentTest = allTests.find(test => test.id === testId);
      if (!currentTest) return;
      
      const instructionsList = document.getElementById('instructionsList');
      instructionsList.innerHTML = '';
      
      currentTest.instructions.forEach(instruction => {
        const li = document.createElement('li');
        li.innerHTML = `<span class="icon">‚Ä¢</span> ${instruction}`;
        instructionsList.appendChild(li);
      });
      
      document.getElementById('testInstructionsModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    // Close test instructions
    function closeTestInstructions() {
      document.getElementById('testInstructionsModal').classList.remove('active');
      document.body.style.overflow = 'auto';
      currentTest = null;
    }

    // Start test
    function startTest() {
      if (!currentTest) return;
      
      // Update student progress
      const studentProgress = JSON.parse(localStorage.getItem('studentProgress')) || {};
      if (!studentProgress[currentTest.id]) {
        studentProgress[currentTest.id] = {
          started: true,
          completed: false,
          progress: 0,
          score: 0
        };
      } else {
        studentProgress[currentTest.id].started = true;
      }
      localStorage.setItem('studentProgress', JSON.stringify(studentProgress));
      
      // Store current test in localStorage for the test page
      localStorage.setItem('currentTest', JSON.stringify(currentTest));
      
      // Redirect to test taking page
      window.location.href = `take-test.html?testId=${currentTest.id}`;
    }

    // View test details
    function viewTestDetails(testId) {
      const test = allTests.find(t => t.id === testId);
      if (test) {
        alert(`Test Details:\n\nName: ${test.name}\nSubject: ${test.subject}\nTeacher: ${test.teacher}\nDuration: ${test.duration}\nQuestions: ${test.questions}\nTotal Marks: ${test.totalMarks}\nDue: ${formatDate(test.dueDate)}\nDifficulty: ${test.difficulty}\nCreated by: ${test.createdBy === 'teacher' ? 'Teacher' : 'System'}`);
      }
    }

    // View results
    function viewResults(testId) {
      const test = allTests.find(t => t.id === testId);
      const studentProgress = JSON.parse(localStorage.getItem('studentProgress')) || {};
      const testProgress = studentProgress[testId] || {};
      
      if (test && test.status === 'completed') {
        alert(`Test Results:\n\nName: ${test.name}\nYour Score: ${testProgress.score || 0}/${test.totalMarks}\nPercentage: ${Math.round(((testProgress.score || 0)/test.totalMarks)*100)}%\nStatus: Completed`);
      }
    }

    // Review test
    function reviewTest(testId) {
      alert('Redirecting to test review page...');
      // In actual implementation, this would redirect to a review page
    }

    // Show success message
    function showSuccessMessage(message) {
      // Create a simple notification
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #2563eb;
        color: white;
        padding: 15px 25px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 10px;
      `;
      notification.innerHTML = `<span>‚úÖ</span><span>${message}</span>`;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        document.body.removeChild(notification);
      }, 3000);
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      loadStudentData();
      
      // Check if we have student tests in localStorage
      const savedTests = localStorage.getItem('studentTests');
      if (savedTests) {
        const studentTests = JSON.parse(savedTests);
        displayTests(studentTests);
        updateTestStatistics(studentTests);
      } else {
        // If no tests saved, fetch from teachers
        fetchTestsFromTeachers();
      }
    });
  </script>
</body>
</html>
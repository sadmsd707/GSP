<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sitting Arrangement - Soham</title>
    <!-- Include jsPDF library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* Dashboard Theme Variables */
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1e3a8a;
            --secondary-color: #f59e0b;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --light-bg: #f5f7fa;
            --card-bg: white;
            --text-color: #333;
            --border-color: #e2e8f0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        header {
            background: linear-gradient(to right, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 100;
            height: 70px;
        }
        
        header h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        /* Improved Hamburger Menu with Animation */
        .hamburger {
            background: none;
            border: none;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            width: 30px;
            height: 21px;
            padding: 0;
            z-index: 1001;
            position: relative;
        }
        
        .hamburger span {
            display: block;
            height: 3px;
            width: 100%;
            background-color: white;
            border-radius: 3px;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            transform-origin: center;
        }
        
        .hamburger.active span:nth-child(1) {
            transform: translateY(9px) rotate(45deg);
        }
        
        .hamburger.active span:nth-child(2) {
            opacity: 0;
            transform: translateX(-20px);
        }
        
        .hamburger.active span:nth-child(3) {
            transform: translateY(-9px) rotate(-45deg);
        }
        
        /* Improved Side Navigation Panel with Animation */
        .side-nav {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100vh;
            background: linear-gradient(to bottom, var(--primary-color), var(--primary-dark));
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            transition: right 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }
        
        .side-nav.active {
            right: 0;
        }
        
        .side-nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            flex: 1;
            overflow-y: auto;
            max-height: 100vh;
        }
        
        .side-nav ul::-webkit-scrollbar {
            width: 5px;
        }
        
        .side-nav ul::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .side-nav ul::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }
        
        .side-nav ul::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        
        .side-nav ul li {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0;
            transform: translateX(20px);
            animation: slideInRight 0.5s forwards;
        }
        
        .side-nav.active ul li {
            opacity: 1;
            transform: translateX(0);
        }
        
        .side-nav ul li:nth-child(1) { animation-delay: 0.1s; }
        .side-nav ul li:nth-child(2) { animation-delay: 0.15s; }
        .side-nav ul li:nth-child(3) { animation-delay: 0.2s; }
        .side-nav ul li:nth-child(4) { animation-delay: 0.25s; }
        .side-nav ul li:nth-child(5) { animation-delay: 0.3s; }
        .side-nav ul li:nth-child(6) { animation-delay: 0.35s; }
        .side-nav ul li:nth-child(7) { animation-delay: 0.4s; }
        .side-nav ul li:nth-child(8) { animation-delay: 0.45s; }
        .side-nav ul li:nth-child(9) { animation-delay: 0.5s; }
        .side-nav ul li:nth-child(10) { animation-delay: 0.55s; }
        .side-nav ul li:nth-child(11) { animation-delay: 0.6s; }
        .side-nav ul li:nth-child(12) { animation-delay: 0.65s; }
        .side-nav ul li:nth-child(13) { animation-delay: 0.7s; }
        .side-nav ul li:nth-child(14) { animation-delay: 0.75s; }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .side-nav ul li:first-child {
            border-top: none;
            margin-top: 70px;
        }
        
        .side-nav ul li a {
            display: block;
            color: white;
            text-decoration: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            background: transparent;
            margin: 0;
        }
        
        .side-nav ul li a:hover {
            background-color: rgba(255, 255, 255, 0.1);
            padding-left: 40px;
            transform: translateX(5px);
        }
        
        .nav-icon {
            font-size: 1.2rem;
            width: 20px;
            text-align: center;
        }
        
        .nav-active {
            background-color: rgba(255, 255, 255, 0.2);
            border-left: 4px solid white;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        /* Main Container */
        .dashboard {
            padding: 30px 20px;
            max-width: 1400px;
            margin: auto;
        }
        
        .welcome-section {
            background: linear-gradient(to right, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.6s ease;
        }
        
        .welcome-section::before {
            content: "";
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(30deg);
        }
        
        .welcome-section h2 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            position: relative;
        }
        
        .welcome-section p {
            font-size: 1.2rem;
            opacity: 0.9;
            position: relative;
        }
        
        /* Stats Cards */
        .stats-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            flex: 1;
            min-width: 200px;
            text-align: center;
            border-left: 4px solid var(--secondary-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: fadeInUp 0.6s ease;
            animation-fill-mode: both;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.12);
        }
        
        .stat-card:nth-child(1) { animation-delay: 0.1s; }
        .stat-card:nth-child(2) { animation-delay: 0.2s; }
        .stat-card:nth-child(3) { animation-delay: 0.3s; }
        .stat-card:nth-child(4) { animation-delay: 0.4s; }
        
        .stat-card h3 {
            font-size: 2.5rem;
            color: var(--primary-dark);
            margin-bottom: 10px;
        }
        
        .stat-card p {
            color: #555;
            font-weight: 600;
        }
        
        /* Division Statistics Section - Always Show All Divisions */
        .division-stats-section {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            animation: fadeInUp 0.6s ease;
            animation-delay: 0.2s;
            animation-fill-mode: both;
        }
        
        .division-stats-section h3 {
            color: var(--primary-dark);
            margin-bottom: 25px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .division-stats-section h3 .icon {
            font-size: 1.5rem;
        }
        
        .divisions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .division-card {
            background: var(--light-bg);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 4px solid var(--primary-color);
            min-height: 120px;
        }
        
        .division-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }
        
        .division-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            flex-shrink: 0;
        }
        
        .division-icon.mc {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        
        .division-icon.ne {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        
        .division-icon.je {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .division-icon.cs {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }
        
        .division-icon.ee {
            background: linear-gradient(135deg, #f39c12, #d35400);
        }
        
        .division-icon.me {
            background: linear-gradient(135deg, #1abc9c, #16a085);
        }
        
        .division-icon.pcb {
            background: linear-gradient(135deg, #e84393, #fd79a8);
        }
        
        .division-icon.neet {
            background: linear-gradient(135deg, #00cec9, #00b894);
        }
        
        .division-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .division-info h4 {
            color: var(--primary-dark);
            font-size: 1.3rem;
            margin: 0;
        }
        
        .division-stats {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .division-stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 12px;
            background: white;
            border-radius: 8px;
            min-width: 70px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .division-stat-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary-dark);
            line-height: 1;
        }
        
        .division-stat-label {
            font-size: 0.8rem;
            color: #666;
            margin-top: 2px;
            text-align: center;
        }
        
        /* NEW: Filter Section */
        .filter-section {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            animation: fadeInUp 0.6s ease;
            animation-delay: 0.3s;
            animation-fill-mode: both;
        }
        
        .filter-section h3 {
            color: var(--primary-dark);
            margin-bottom: 25px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .filter-section h3 .icon {
            font-size: 1.5rem;
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 20px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .filter-group label {
            font-weight: 600;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-group label .icon {
            font-size: 1.2rem;
        }
        
        /* Custom Multi-Select Styling */
        .multi-select-wrapper {
            position: relative;
        }
        
        .multi-select-display {
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--light-bg);
            color: var(--text-color);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .multi-select-display:hover {
            border-color: var(--primary-color);
        }
        
        .multi-select-display::after {
            content: "‚ñº";
            font-size: 0.8rem;
            transition: transform 0.3s ease;
        }
        
        .multi-select-display.active::after {
            transform: rotate(180deg);
        }
        
        .multi-select-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 100;
            display: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .multi-select-dropdown.active {
            display: block;
            animation: fadeInUp 0.3s ease;
        }
        
        .multi-select-option {
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .multi-select-option:hover {
            background-color: var(--light-bg);
        }
        
        .multi-select-option.selected {
            background-color: rgba(37, 99, 235, 0.1);
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .multi-select-option.selected::before {
            content: "‚úì";
            font-weight: bold;
        }
        
        .multi-select-checkbox {
            display: none;
        }
        
        .filter-select {
            display: none; /* Hide original select */
        }
        
        .selected-count {
            font-size: 0.9rem;
            color: var(--primary-color);
            margin-left: auto;
            background: rgba(37, 99, 235, 0.1);
            padding: 2px 8px;
            border-radius: 12px;
        }
        
        .filter-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 15px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        .filter-actions .btn {
            padding: 10px 20px;
            font-size: 0.95rem;
        }
        
        .selected-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        
        .filter-tag {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 8px;
            animation: fadeInUp 0.3s ease;
        }
        
        .filter-tag .close-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0;
            font-size: 1rem;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .filter-tag .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* Dashboard Section */
        .dashboard-section {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            animation: fadeInUp 0.6s ease;
            animation-fill-mode: both;
        }
        
        .dashboard-section:nth-child(1) { animation-delay: 0.1s; }
        .dashboard-section:nth-child(2) { animation-delay: 0.2s; }
        .dashboard-section:nth-child(3) { animation-delay: 0.3s; }
        .dashboard-section:nth-child(4) { animation-delay: 0.4s; }
        
        .dashboard-section h3 {
            color: var(--primary-dark);
            margin-bottom: 20px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .dashboard-section h3 .icon {
            font-size: 1.5rem;
        }
        
        /* Classroom Container */
        .classroom-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .classroom-card {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            padding: 20px;
            transition: all 0.3s ease;
            border-left: 4px solid var(--primary-color);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s ease forwards;
        }
        
        .classroom-card:nth-child(1) { animation-delay: 0.1s; }
        .classroom-card:nth-child(2) { animation-delay: 0.2s; }
        .classroom-card:nth-child(3) { animation-delay: 0.3s; }
        .classroom-card:nth-child(4) { animation-delay: 0.4s; }
        .classroom-card:nth-child(5) { animation-delay: 0.5s; }
        .classroom-card:nth-child(6) { animation-delay: 0.6s; }
        
        .classroom-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .classroom-card h3 {
            text-align: center;
            color: var(--primary-dark);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }
        
        /* Seating Grid */
        .seating-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .seat {
            color: white;
            border-radius: 8px;
            padding: 15px 5px;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 70px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .seat:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }
        
        /* Division Colors */
        .seat.mc {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        
        .seat.ne {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        
        .seat.je {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .seat.cs {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }
        
        .seat.ee {
            background: linear-gradient(135deg, #f39c12, #d35400);
        }
        
        .seat.me {
            background: linear-gradient(135deg, #1abc9c, #16a085);
        }
        
        .seat.pcb {
            background: linear-gradient(135deg, #e84393, #fd79a8);
        }
        
        .seat.neet {
            background: linear-gradient(135deg, #00cec9, #00b894);
        }
        
        .seat-number {
            font-size: 0.9rem;
            margin-bottom: 5px;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }
        
        .student-id {
            font-size: 0.85rem;
            opacity: 0.95;
            position: relative;
            z-index: 1;
        }
        
        .teacher-desk {
            grid-column: span 4;
            background: linear-gradient(135deg, var(--primary-dark), #2c3e50);
            color: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            margin-top: 10px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }
        
        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: var(--secondary-color);
        }
        
        .btn-secondary:hover {
            background: #d97706;
        }
        
        .btn-success {
            background: var(--success-color);
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-danger {
            background: var(--danger-color);
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .empty-seat {
            background: #ecf0f1;
            color: #7f8c8d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
        }
        
        footer {
            background: var(--primary-dark);
            color: white;
            text-align: center;
            padding: 30px;
            margin-top: 50px;
            animation: fadeInUp 0.6s ease;
        }
        
        footer p {
            font-size: 1rem;
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .classroom-container {
                grid-template-columns: 1fr;
            }
            
            .divisions-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .filter-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .seating-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .teacher-desk {
                grid-column: span 2;
            }
            
            .stats-container {
                flex-direction: column;
            }
            
            .divisions-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .filter-actions {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-actions .btn {
                width: 100%;
                justify-content: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
            
            .division-card {
                padding: 15px;
            }
            
            .division-icon {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }
        }
        
        @media (max-width: 480px) {
            .seating-grid {
                grid-template-columns: 1fr;
            }
            
            .teacher-desk {
                grid-column: span 1;
            }
            
            .division-card {
                flex-direction: column;
                text-align: center;
                min-height: auto;
                padding: 20px;
            }
            
            .division-stats {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .division-stat-item {
                min-width: 60px;
                padding: 6px 8px;
            }
            
            .welcome-section h2 {
                font-size: 1.8rem;
            }
            
            .welcome-section p {
                font-size: 1rem;
            }
            
            .filter-tag {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
        }
        
        /* Modal for seat details with Animation */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--card-bg);
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: slideInUp 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(100px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            background: var(--primary-color);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
            font-size: 1.5rem;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            transition: transform 0.3s ease;
        }
        
        .close-modal:hover {
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 30px;
        }
        
        .seat-details {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .detail-row {
            display: flex;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
            animation: fadeInUp 0.5s ease;
            animation-fill-mode: both;
        }
        
        .detail-row:nth-child(1) { animation-delay: 0.1s; }
        .detail-row:nth-child(2) { animation-delay: 0.2s; }
        .detail-row:nth-child(3) { animation-delay: 0.3s; }
        .detail-row:nth-child(4) { animation-delay: 0.4s; }
        .detail-row:nth-child(5) { animation-delay: 0.5s; }
        .detail-row:nth-child(6) { animation-delay: 0.6s; }
        
        .detail-label {
            font-weight: 600;
            color: var(--primary-dark);
            min-width: 120px;
        }
        
        .detail-value {
            color: #1e293b;
        }
        
        .seat-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-present {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .status-absent {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Notification Styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success-color);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 9999;
            animation: slideInRight 0.3s ease, fadeOut 0.3s ease 3s forwards;
            min-width: 300px;
            max-width: 400px;
        }
        
        .notification-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .notification-message {
            margin-right: 20px;
        }
        
        .notification-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .notification-error {
            background: var(--danger-color);
        }
        
        .notification-warning {
            background: var(--secondary-color);
        }
        
        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100px);
            }
        }
        
        /* Animation Keyframes */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* Ripple animation for buttons */
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Soham - Sitting Arrangement</h1>
        <button class="hamburger" id="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </header>

    <!-- Updated Side Navigation with Enhanced Animation -->
    <div class="side-nav" id="sideNav">
        <ul>
            <li><a href="teacher-dashboard.html" class="nav-active"><span class="nav-icon">üìä</span>Dashboard</a></li>
            <li><a href="teacher-classes.html"><span class="nav-icon">üè´</span>My Classes</a></li>
            <li><a href="attendance.html"><span class="nav-icon">üìÖ</span>Attendance</a></li>
            <li><a href="announcements.html"><span class="nav-icon">üì¢</span>Announcements</a></li>
            <li><a href="create-test.html"><span class="nav-icon">‚úèÔ∏è</span>Create Test</a></li>
            <li><a href="my-tests.html"><span class="nav-icon">üìù</span>My Tests</a></li>
            <li><a href="sitting-arrangement.html"><span class="nav-icon">üí∫</span>Sitting Arrangement</a></li>
            <li><a href="omr-scanner.html"><span class="nav-icon">üì∏</span>OMR Scanner</a></li>
            <li><a href="teacher-scores.html"><span class="nav-icon">üìà</span>Student Scores</a></li>
            <li><a href="add-student.html"><span class="nav-icon">üë®‚Äçüéì</span>Add Student</a></li>
            <li><a href="teacher-parent.html"><span class="nav-icon">üë™</span>Parent Section</a></li>
            <li><a href="teacher-resources.html"><span class="nav-icon">üìö</span>Resources</a></li>
            <li><a href="my-account.html"><span class="nav-icon">üë§</span>My Account</a></li>
            <li><a href="role-selection.html" onclick="logout()"><span class="nav-icon">üö™</span>Logout</a></li>
        </ul>
    </div>

    <!-- Overlay for closing the menu when clicking outside -->
    <div class="overlay" id="overlay"></div>

    <!-- Seat Details Modal -->
    <div class="modal" id="seatDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Seat Details</h3>
                <button class="close-modal" onclick="closeSeatDetails()">√ó</button>
            </div>
            <div class="modal-body" id="seatDetailsContent">
                <!-- Seat details will be populated here -->
            </div>
        </div>
    </div>

    <main class="dashboard">
        <section class="welcome-section">
            <h2>Sitting Arrangement</h2>
            <p>Intelligent seating with no same division students adjacent</p>
        </section>

        <div class="stats-container">
            <div class="stat-card">
                <h3 id="totalStudents">0</h3>
                <p>Total Students</p>
            </div>
            <div class="stat-card">
                <h3>6</h3>
                <p>Classrooms</p>
            </div>
            <div class="stat-card">
                <h3>8</h3>
                <p>Divisions</p>
            </div>
            <div class="stat-card">
                <h3 id="assignedSeats">0</h3>
                <p>Assigned Seats</p>
            </div>
        </div>

        <!-- UPDATED Division Statistics Section - Always Show All Divisions -->
        <section class="division-stats-section">
            <h3><span class="icon">üìä</span> Division Statistics</h3>
            <div class="divisions-grid" id="divisionStatsContainer">
                <!-- Division cards will be generated here -->
            </div>
        </section>

        <!-- NEW: Filter Section with Custom Multi-Select -->
        <section class="filter-section">
            <h3><span class="icon">üîç</span> Filter Options</h3>
            <div class="filter-grid">
                <div class="filter-group">
                    <label><span class="icon">üè´</span> Select Classes</label>
                    <div class="multi-select-wrapper">
                        <div class="multi-select-display" id="classFilterDisplay">
                            <span>Select Classes</span>
                            <span class="selected-count">0 selected</span>
                        </div>
                        <div class="multi-select-dropdown" id="classFilterDropdown">
                            <div class="multi-select-option" data-value="all">All Classes</div>
                            <div class="multi-select-option" data-value="mc">11th JEE (MC)</div>
                            <div class="multi-select-option" data-value="ne">11th MHT CET (PCM) (NE)</div>
                            <div class="multi-select-option" data-value="je">11th MHT CET (PCB) (JE)</div>
                            <div class="multi-select-option" data-value="cs">11th NEET (CS)</div>
                            <div class="multi-select-option" data-value="ee">12th JEE (EE)</div>
                            <div class="multi-select-option" data-value="me">12th MHT CET (PCM) (ME)</div>
                            <div class="multi-select-option" data-value="pcb">12th MHT CET (PCB) (PCB)</div>
                            <div class="multi-select-option" data-value="neet">12th NEET (NEET)</div>
                        </div>
                    </div>
                    <small>Click to select multiple classes</small>
                </div>
                <div class="filter-group">
                    <label><span class="icon">üö™</span> Select Classrooms</label>
                    <div class="multi-select-wrapper">
                        <div class="multi-select-display" id="classroomFilterDisplay">
                            <span>Select Classrooms</span>
                            <span class="selected-count">0 selected</span>
                        </div>
                        <div class="multi-select-dropdown" id="classroomFilterDropdown">
                            <div class="multi-select-option" data-value="all">All Classrooms</div>
                            <div class="multi-select-option" data-value="1">Classroom 1</div>
                            <div class="multi-select-option" data-value="2">Classroom 2</div>
                            <div class="multi-select-option" data-value="3">Classroom 3</div>
                            <div class="multi-select-option" data-value="4">Classroom 4</div>
                            <div class="multi-select-option" data-value="5">Classroom 5</div>
                            <div class="multi-select-option" data-value="6">Classroom 6</div>
                        </div>
                    </div>
                    <small>Click to select multiple classrooms</small>
                </div>
            </div>
            <div class="filter-actions">
                <button class="btn btn-secondary" id="clearFilterBtn">
                    <span>üóëÔ∏è</span> Clear Filters
                </button>
                <button class="btn" id="applyFilterBtn">
                    <span>‚úÖ</span> Apply Filters
                </button>
            </div>
            <div class="selected-filters" id="selectedFilters">
                <!-- Selected filters will be displayed here -->
            </div>
        </section>

        <section class="dashboard-section">
            <h3><span class="icon">üí∫</span> Classroom Seating Arrangements</h3>
            <div class="classroom-container" id="classroomContainer">
                <!-- Classrooms will be generated here -->
            </div>
        </section>

        <section class="dashboard-section">
            <h3><span class="icon">‚öôÔ∏è</span> Controls</h3>
            <div class="controls">
                <button class="btn" id="regenerateBtn">
                    <span>üîÑ</span> Regenerate Arrangement
                </button>
                <button class="btn btn-secondary" id="downloadPdfBtn">
                    <span>üì•</span> Download PDF
                </button>
                <button class="btn btn-danger" id="clearBtn">
                    <span>üóëÔ∏è</span> Clear All
                </button>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2026 Soham - Entrance Exam Practice. All rights reserved.</p>
        <p style="margin-top: 10px; font-size: 0.9rem;">Made with ‚ù§Ô∏è by Team Soham</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Authentication check
            if (localStorage.getItem("isLoggedIn") !== "true" || localStorage.getItem("userRole") !== "teacher") {
                window.location.href = "role-selection.html";
            }

            // Enhanced Hamburger menu functionality with animation
            const hamburger = document.getElementById('hamburger');
            const sideNav = document.getElementById('sideNav');
            const overlay = document.getElementById('overlay');
            const classroomContainer = document.getElementById('classroomContainer');
            const divisionStatsContainer = document.getElementById('divisionStatsContainer');
            const regenerateBtn = document.getElementById('regenerateBtn');
            const downloadPdfBtn = document.getElementById('downloadPdfBtn');
            const clearBtn = document.getElementById('clearBtn');
            const applyFilterBtn = document.getElementById('applyFilterBtn');
            const clearFilterBtn = document.getElementById('clearFilterBtn');
            const selectedFiltersContainer = document.getElementById('selectedFilters');
            
            // Custom multi-select elements
            const classFilterDisplay = document.getElementById('classFilterDisplay');
            const classFilterDropdown = document.getElementById('classFilterDropdown');
            const classFilterOptions = classFilterDropdown.querySelectorAll('.multi-select-option');
            
            const classroomFilterDisplay = document.getElementById('classroomFilterDisplay');
            const classroomFilterDropdown = document.getElementById('classroomFilterDropdown');
            const classroomFilterOptions = classroomFilterDropdown.querySelectorAll('.multi-select-option');
            
            // Current filter state
            let currentFilters = {
                classes: ['all'],  // Default: All classes
                classrooms: ['all'] // Default: All classrooms
            };
            
            // Initialize selected options
            classFilterOptions[0].classList.add('selected'); // Select "All Classes" by default
            classroomFilterOptions[0].classList.add('selected'); // Select "All Classrooms" by default
            
            // Filter display names
            const classDisplayNames = {
                'mc': '11th JEE (MC)',
                'ne': '11th MHT CET (PCM) (NE)',
                'je': '11th MHT CET (PCB) (JE)',
                'cs': '11th NEET (CS)',
                'ee': '12th JEE (EE)',
                'me': '12th MHT CET (PCM) (ME)',
                'pcb': '12th MHT CET (PCB) (PCB)',
                'neet': '12th NEET (NEET)',
                'all': 'All Classes'
            };
            
            const classroomDisplayNames = {
                '1': 'Classroom 1',
                '2': 'Classroom 2',
                '3': 'Classroom 3',
                '4': 'Classroom 4',
                '5': 'Classroom 5',
                '6': 'Classroom 6',
                'all': 'All Classrooms'
            };
            
            hamburger.addEventListener('click', () => {
                hamburger.classList.toggle('active');
                sideNav.classList.toggle('active');
                overlay.classList.toggle('active');
                document.body.style.overflow = sideNav.classList.contains('active') ? 'hidden' : 'auto';
            });

            overlay.addEventListener('click', () => {
                hamburger.classList.remove('active');
                sideNav.classList.remove('active');
                overlay.classList.remove('active');
                document.body.style.overflow = 'auto';
            });

            // Close menu when clicking on a link
            const navLinks = document.querySelectorAll('.side-nav a');
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    hamburger.classList.remove('active');
                    sideNav.classList.remove('active');
                    overlay.classList.remove('active');
                    document.body.style.overflow = 'auto';
                    
                    // Remove active class from all links
                    navLinks.forEach(link => link.classList.remove('nav-active'));
                    // Add active class to clicked link
                    link.classList.add('nav-active');
                });
            });

            // Close menu on escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && sideNav.classList.contains('active')) {
                    hamburger.classList.remove('active');
                    sideNav.classList.remove('active');
                    overlay.classList.remove('active');
                    document.body.style.overflow = 'auto';
                }
            });

            // Add ripple effect to buttons
            const buttons = document.querySelectorAll('.btn');
            buttons.forEach(button => {
                button.addEventListener('click', function(e) {
                    const x = e.clientX - e.target.getBoundingClientRect().left;
                    const y = e.clientY - e.target.getBoundingClientRect().top;
                    
                    const ripple = document.createElement('span');
                    ripple.style.cssText = `
                        position: absolute;
                        background: rgba(255, 255, 255, 0.5);
                        border-radius: 50%;
                        transform: scale(0);
                        animation: ripple 0.6s linear;
                        width: 100px;
                        height: 100px;
                        top: ${y - 50}px;
                        left: ${x - 50}px;
                    `;
                    
                    this.style.position = 'relative';
                    this.style.overflow = 'hidden';
                    this.appendChild(ripple);
                    
                    setTimeout(() => ripple.remove(), 600);
                });
                
                // Add hover effect
                button.addEventListener('mouseenter', () => {
                    button.style.transform = 'translateY(-2px)';
                });
                button.addEventListener('mouseleave', () => {
                    button.style.transform = 'translateY(0)';
                });
            });
            
            // Student data with 8 divisions
            const students = {
                mc: {
                    range: [[1101, 1125], [1201, 1225]],
                    count: 50,
                    color: 'mc',
                    fullName: '11th JEE',
                    icon: 'üîß'
                },
                ne: {
                    range: [[1101, 1125], [1201, 1225]],
                    count: 50,
                    color: 'ne',
                    fullName: '11th MHT CET (PCM)',
                    icon: '‚ö°'
                },
                je: {
                    range: [[1101, 1125], [1201, 1225]],
                    count: 50,
                    color: 'je',
                    fullName: '11th MHT CET (PCB)',
                    icon: '‚öñÔ∏è'
                },
                cs: {
                    range: [[1101, 1125], [1201, 1225]],
                    count: 50,
                    color: 'cs',
                    fullName: '11th NEET',
                    icon: 'üíª'
                },
                ee: {
                    range: [[1101, 1125], [1201, 1225]],
                    count: 50,
                    color: 'ee',
                    fullName: '12th JEE',
                    icon: 'üîå'
                },
                me: {
                    range: [[1101, 1125], [1201, 1225]],
                    count: 50,
                    color: 'me',
                    fullName: '12th MHT CET (PCM)',
                    icon: '‚öôÔ∏è'
                },
                pcb: {
                    range: [[1101, 1125], [1201, 1225]],
                    count: 50,
                    color: 'pcb',
                    fullName: '12th MHT CET (PCB)',
                    icon: 'üß™'
                },
                neet: {
                    range: [[1101, 1125], [1201, 1225]],
                    count: 50,
                    color: 'neet',
                    fullName: '12th NEET',
                    icon: 'üè•'
                }
            };
            
            // Custom Multi-Select Functionality
            function initializeMultiSelect(displayElement, dropdownElement, options, filterType) {
                // Toggle dropdown
                displayElement.addEventListener('click', function(e) {
                    e.stopPropagation();
                    dropdownElement.classList.toggle('active');
                    displayElement.classList.toggle('active');
                    
                    // Close other dropdowns
                    if (filterType === 'class') {
                        classroomFilterDropdown.classList.remove('active');
                        classroomFilterDisplay.classList.remove('active');
                    } else {
                        classFilterDropdown.classList.remove('active');
                        classFilterDisplay.classList.remove('active');
                    }
                });
                
                // Handle option selection
                options.forEach(option => {
                    option.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const value = this.getAttribute('data-value');
                        
                        // Handle "All" selection
                        if (value === 'all') {
                            // If clicking "All", select only "All" and deselect others
                            options.forEach(opt => {
                                opt.classList.remove('selected');
                            });
                            this.classList.add('selected');
                        } else {
                            // If clicking a specific option
                            const allOption = Array.from(options).find(opt => opt.getAttribute('data-value') === 'all');
                            
                            // Deselect "All" if it was selected
                            if (allOption.classList.contains('selected')) {
                                allOption.classList.remove('selected');
                            }
                            
                            // Toggle this option
                            this.classList.toggle('selected');
                            
                            // If no options are selected, select "All"
                            const selectedOptions = Array.from(options).filter(opt => opt.classList.contains('selected'));
                            if (selectedOptions.length === 0) {
                                allOption.classList.add('selected');
                            }
                        }
                        
                        updateFilterDisplay(displayElement, options, filterType);
                    });
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', function(e) {
                    if (!displayElement.contains(e.target) && !dropdownElement.contains(e.target)) {
                        dropdownElement.classList.remove('active');
                        displayElement.classList.remove('active');
                    }
                });
                
                // Update display text
                updateFilterDisplay(displayElement, options, filterType);
            }
            
            function updateFilterDisplay(displayElement, options, filterType) {
                const selectedOptions = Array.from(options).filter(opt => opt.classList.contains('selected'));
                const selectedValues = selectedOptions.map(opt => opt.getAttribute('data-value'));
                
                // Update filter state
                if (filterType === 'class') {
                    currentFilters.classes = selectedValues;
                } else {
                    currentFilters.classrooms = selectedValues;
                }
                
                // Update display text
                const displayText = displayElement.querySelector('span:first-child');
                const selectedCount = displayElement.querySelector('.selected-count');
                
                if (selectedValues.includes('all')) {
                    displayText.textContent = 'All ' + (filterType === 'class' ? 'Classes' : 'Classrooms');
                } else if (selectedValues.length === 0) {
                    displayText.textContent = 'Select ' + (filterType === 'class' ? 'Classes' : 'Classrooms');
                } else if (selectedValues.length === 1) {
                    const displayName = filterType === 'class' ? 
                        classDisplayNames[selectedValues[0]] : 
                        classroomDisplayNames[selectedValues[0]];
                    displayText.textContent = displayName;
                } else {
                    displayText.textContent = `${selectedValues.length} ${filterType === 'class' ? 'Classes' : 'Classrooms'} selected`;
                }
                
                selectedCount.textContent = `${selectedValues.includes('all') ? 'All' : selectedValues.length} selected`;
                
                // Update selected filters display
                updateSelectedFiltersDisplay();
            }
            
            // Initialize multi-selects
            initializeMultiSelect(classFilterDisplay, classFilterDropdown, classFilterOptions, 'class');
            initializeMultiSelect(classroomFilterDisplay, classroomFilterDropdown, classroomFilterOptions, 'classroom');
            
            // Generate student IDs
            function generateStudentIds() {
                const studentIds = [];
                
                for (const division in students) {
                    const ranges = students[division].range;
                    for (const range of ranges) {
                        for (let i = range[0]; i <= range[1]; i++) {
                            studentIds.push({
                                id: `${division.toUpperCase()}${i}`,
                                division: division,
                                color: students[division].color,
                                fullName: students[division].fullName,
                                icon: students[division].icon
                            });
                        }
                    }
                }
                
                return studentIds;
            }
            
            // Filter student IDs based on selected classes
            function filterStudentIds(studentIds, selectedClasses) {
                if (selectedClasses.includes('all')) {
                    return studentIds;
                }
                return studentIds.filter(student => selectedClasses.includes(student.division));
            }
            
            // Shuffle array
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
            
            // Generate division statistics - ALWAYS SHOW ALL DIVISIONS
            function generateDivisionStats(arrangedStudents) {
                divisionStatsContainer.innerHTML = '';
                
                const divisionStats = {
                    mc: { total: 0, assigned: 0 },
                    ne: { total: 0, assigned: 0 },
                    je: { total: 0, assigned: 0 },
                    cs: { total: 0, assigned: 0 },
                    ee: { total: 0, assigned: 0 },
                    me: { total: 0, assigned: 0 },
                    pcb: { total: 0, assigned: 0 },
                    neet: { total: 0, assigned: 0 }
                };
                
                // Count total students per division (ALL STUDENTS, regardless of filters)
                let allStudents = generateStudentIds();
                
                allStudents.forEach(student => {
                    divisionStats[student.division].total++;
                });
                
                // Count assigned students per division (from current arrangement)
                arrangedStudents.forEach(student => {
                    if (student && divisionStats[student.division]) {
                        divisionStats[student.division].assigned++;
                    }
                });
                
                // Create division cards for ALL divisions
                for (const division in students) {
                    const stats = divisionStats[division];
                    const divisionData = students[division];
                    
                    const divisionCard = document.createElement('div');
                    divisionCard.className = 'division-card';
                    divisionCard.setAttribute('data-division', division);
                    
                    // Add click event to show division details
                    divisionCard.addEventListener('click', () => {
                        showDivisionDetails(division, divisionData, stats);
                    });
                    
                    divisionCard.innerHTML = `
                        <div class="division-icon ${divisionData.color}">
                            ${divisionData.icon}
                        </div>
                        <div class="division-info">
                            <h4>${divisionData.fullName}</h4>
                            <div class="division-stats">
                                <div class="division-stat-item">
                                    <div class="division-stat-value">${stats.total}</div>
                                    <div class="division-stat-label">Total</div>
                                </div>
                                <div class="division-stat-item">
                                    <div class="division-stat-value">${stats.assigned}</div>
                                    <div class="division-stat-label">Assigned</div>
                                </div>
                                <div class="division-stat-item">
                                    <div class="division-stat-value">${stats.total - stats.assigned}</div>
                                    <div class="division-stat-label">Remaining</div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    divisionStatsContainer.appendChild(divisionCard);
                }
            }
            
            // Show division details
            function showDivisionDetails(division, divisionData, stats) {
                const modalContent = document.getElementById('seatDetailsContent');
                
                // Get today's attendance for this division
                const today = new Date().toISOString().split('T')[0];
                const attendanceRecords = JSON.parse(localStorage.getItem('attendanceRecords')) || {};
                const todayAttendance = attendanceRecords[today] || {};
                
                // Count attendance for this division
                let presentCount = 0;
                let absentCount = 0;
                
                for (const studentId in todayAttendance) {
                    if (studentId.startsWith(division.toUpperCase())) {
                        if (todayAttendance[studentId].status === 'present') {
                            presentCount++;
                        } else if (todayAttendance[studentId].status === 'absent') {
                            absentCount++;
                        }
                    }
                }
                
                modalContent.innerHTML = `
                    <div class="seat-details">
                        <div class="detail-row">
                            <div class="detail-label">Division:</div>
                            <div class="detail-value">${divisionData.fullName}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Division Code:</div>
                            <div class="detail-value">${division.toUpperCase()}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Total Students:</div>
                            <div class="detail-value">${stats.total}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Assigned Seats:</div>
                            <div class="detail-value">${stats.assigned} (${Math.round((stats.assigned / stats.total) * 100)}%)</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Today's Attendance:</div>
                            <div class="detail-value">
                                <span class="seat-status status-present">Present: ${presentCount}</span>
                                <span class="seat-status status-absent" style="margin-left: 10px;">Absent: ${absentCount}</span>
                            </div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Unassigned:</div>
                            <div class="detail-value">${stats.total - stats.assigned} students</div>
                        </div>
                    </div>
                `;
                
                document.getElementById('seatDetailsModal').classList.add('active');
                document.body.style.overflow = 'hidden';
                
                // Update modal title
                document.querySelector('.modal-header h3').textContent = `${divisionData.fullName} Details`;
            }
            
            // Generate seating arrangement for a classroom
            function generateClassroomArrangement(students, rows, columns) {
                const totalSeats = rows * columns;
                const arrangement = new Array(totalSeats).fill(null);
                const availableStudents = [...students];
                
                // Try to place each student
                for (let i = 0; i < totalSeats && availableStudents.length > 0; i++) {
                    // Find a student that doesn't conflict with neighbors
                    let studentIndex = -1;
                    
                    for (let j = 0; j < availableStudents.length; j++) {
                        const student = availableStudents[j];
                        let conflict = false;
                        
                        // Check left neighbor
                        if (i % columns > 0 && arrangement[i-1] && arrangement[i-1].division === student.division) {
                            conflict = true;
                        }
                        
                        // Check top neighbor
                        if (i >= columns && arrangement[i-columns] && arrangement[i-columns].division === student.division) {
                            conflict = true;
                        }
                        
                        // Check right neighbor (for edge cases)
                        if (i % columns < columns - 1 && arrangement[i+1] && arrangement[i+1].division === student.division) {
                            conflict = true;
                        }
                        
                        // Check bottom neighbor
                        if (i < totalSeats - columns && arrangement[i+columns] && arrangement[i+columns].division === student.division) {
                            conflict = true;
                        }
                        
                        if (!conflict) {
                            studentIndex = j;
                            break;
                        }
                    }
                    
                    // If no non-conflicting student found, just take the first available
                    if (studentIndex === -1 && availableStudents.length > 0) {
                        studentIndex = 0;
                    }
                    
                    if (studentIndex !== -1) {
                        arrangement[i] = availableStudents[studentIndex];
                        availableStudents.splice(studentIndex, 1);
                    }
                }
                
                return {
                    arrangement: arrangement,
                    remaining: availableStudents
                };
            }
            
            // Create classroom HTML
            function createClassroomHTML(classroomNumber, arrangement, rows, columns) {
                const classroomDiv = document.createElement('div');
                classroomDiv.className = 'classroom-card';
                classroomDiv.setAttribute('data-classroom', classroomNumber);
                
                const classroomTitle = document.createElement('h3');
                classroomTitle.textContent = `Classroom ${classroomNumber}`;
                classroomDiv.appendChild(classroomTitle);
                
                const gridDiv = document.createElement('div');
                gridDiv.className = 'seating-grid';
                
                // Create seats
                for (let i = 0; i < arrangement.length; i++) {
                    const seat = document.createElement('div');
                    
                    if (arrangement[i]) {
                        seat.className = `seat ${arrangement[i].color}`;
                        seat.setAttribute('data-seat-number', i + 1);
                        seat.setAttribute('data-student-id', arrangement[i].id);
                        seat.setAttribute('data-division', arrangement[i].division);
                        
                        const seatNumber = document.createElement('div');
                        seatNumber.className = 'seat-number';
                        seatNumber.textContent = `Seat ${i+1}`;
                        
                        const studentId = document.createElement('div');
                        studentId.className = 'student-id';
                        studentId.textContent = arrangement[i].id;
                        
                        seat.appendChild(seatNumber);
                        seat.appendChild(studentId);
                        
                        // Add click event for seat details
                        seat.addEventListener('click', () => showSeatDetails({
                            seatNumber: i + 1,
                            studentId: arrangement[i].id,
                            division: arrangement[i].division,
                            classroom: classroomNumber
                        }));
                    } else {
                        seat.className = 'seat empty-seat';
                        seat.textContent = 'Empty Seat';
                        seat.setAttribute('data-seat-number', i + 1);
                        
                        seat.addEventListener('click', () => showSeatDetails({
                            seatNumber: i + 1,
                            studentId: null,
                            division: null,
                            classroom: classroomNumber
                        }));
                    }
                    
                    gridDiv.appendChild(seat);
                }
                
                // Add teacher's desk
                const teacherDesk = document.createElement('div');
                teacherDesk.className = 'teacher-desk';
                teacherDesk.innerHTML = '<span>üë®‚Äçüè´</span> Teacher\'s Desk';
                gridDiv.appendChild(teacherDesk);
                
                classroomDiv.appendChild(gridDiv);
                return classroomDiv;
            }
            
            // Show seat details modal
            function showSeatDetails(data) {
                const modalContent = document.getElementById('seatDetailsContent');
                
                if (data.studentId) {
                    // Get attendance data from localStorage
                    const today = new Date().toISOString().split('T')[0];
                    const attendanceRecords = JSON.parse(localStorage.getItem('attendanceRecords')) || {};
                    const todayAttendance = attendanceRecords[today] || {};
                    const studentAttendance = todayAttendance[data.studentId];
                    
                    modalContent.innerHTML = `
                        <div class="seat-details">
                            <div class="detail-row">
                                <div class="detail-label">Seat Number:</div>
                                <div class="detail-value">${data.seatNumber}</div>
                            </div>
                            <div class="detail-row">
                                <div class="detail-label">Classroom:</div>
                                <div class="detail-value">Classroom ${data.classroom}</div>
                            </div>
                            <div class="detail-row">
                                <div class="detail-label">Student ID:</div>
                                <div class="detail-value">${data.studentId}</div>
                            </div>
                            <div class="detail-row">
                                <div class="detail-label">Division:</div>
                                <div class="detail-value">${students[data.division].fullName}</div>
                            </div>
                            <div class="detail-row">
                                <div class="detail-label">Today's Attendance:</div>
                                <div class="detail-value">
                                    ${studentAttendance ? 
                                        `<span class="seat-status status-${studentAttendance.status}">
                                            ${studentAttendance.status.charAt(0).toUpperCase() + studentAttendance.status.slice(1)}
                                        </span>` : 
                                        '<span class="seat-status">Not Marked</span>'}
                                </div>
                            </div>
                            <div class="detail-row">
                                <div class="detail-label">Seat Status:</div>
                                <div class="detail-value">Occupied</div>
                            </div>
                        </div>
                    `;
                } else {
                    modalContent.innerHTML = `
                        <div class="seat-details">
                            <div class="detail-row">
                                <div class="detail-label">Seat Number:</div>
                                <div class="detail-value">${data.seatNumber}</div>
                            </div>
                            <div class="detail-row">
                                <div class="detail-label">Classroom:</div>
                                <div class="detail-value">Classroom ${data.classroom}</div>
                            </div>
                            <div class="detail-row">
                                <div class="detail-label">Student ID:</div>
                                <div class="detail-value">Not Assigned</div>
                            </div>
                            <div class="detail-row">
                                <div class="detail-label">Division:</div>
                                <div class="detail-value">-</div>
                            </div>
                            <div class="detail-row">
                                <div class="detail-label">Seat Status:</div>
                                <div class="detail-value">Available</div>
                            </div>
                        </div>
                    `;
                }
                
                document.getElementById('seatDetailsModal').classList.add('active');
                document.body.style.overflow = 'hidden';
                
                // Update modal title
                document.querySelector('.modal-header h3').textContent = 'Seat Details';
            }
            
            // Close seat details modal
            function closeSeatDetails() {
                document.getElementById('seatDetailsModal').classList.remove('active');
                document.body.style.overflow = 'auto';
            }
            
            // Update selected filters display
            function updateSelectedFiltersDisplay() {
                selectedFiltersContainer.innerHTML = '';
                
                // Add class filters
                currentFilters.classes.forEach(filter => {
                    if (filter === 'all') return;
                    const filterTag = document.createElement('div');
                    filterTag.className = 'filter-tag';
                    filterTag.innerHTML = `
                        <span>üè´ ${classDisplayNames[filter]}</span>
                        <button class="close-btn" data-type="class" data-value="${filter}">√ó</button>
                    `;
                    selectedFiltersContainer.appendChild(filterTag);
                });
                
                // Add classroom filters
                currentFilters.classrooms.forEach(filter => {
                    if (filter === 'all') return;
                    const filterTag = document.createElement('div');
                    filterTag.className = 'filter-tag';
                    filterTag.innerHTML = `
                        <span>üö™ ${classroomDisplayNames[filter]}</span>
                        <button class="close-btn" data-type="classroom" data-value="${filter}">√ó</button>
                    `;
                    selectedFiltersContainer.appendChild(filterTag);
                });
                
                // Add event listeners to remove buttons
                document.querySelectorAll('.filter-tag .close-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const type = e.target.getAttribute('data-type');
                        const value = e.target.getAttribute('data-value');
                        removeFilter(type, value);
                    });
                });
            }
            
            // Remove a filter
            function removeFilter(type, value) {
                if (type === 'class') {
                    // Find and deselect the option in the multi-select
                    const optionToRemove = Array.from(classFilterOptions).find(
                        opt => opt.getAttribute('data-value') === value
                    );
                    if (optionToRemove) {
                        optionToRemove.classList.remove('selected');
                        
                        // If no options are selected, select "All"
                        const selectedOptions = Array.from(classFilterOptions).filter(opt => opt.classList.contains('selected'));
                        if (selectedOptions.length === 0) {
                            const allOption = classFilterOptions[0];
                            allOption.classList.add('selected');
                        }
                        
                        updateFilterDisplay(classFilterDisplay, classFilterOptions, 'class');
                    }
                } else if (type === 'classroom') {
                    // Find and deselect the option in the multi-select
                    const optionToRemove = Array.from(classroomFilterOptions).find(
                        opt => opt.getAttribute('data-value') === value
                    );
                    if (optionToRemove) {
                        optionToRemove.classList.remove('selected');
                        
                        // If no options are selected, select "All"
                        const selectedOptions = Array.from(classroomFilterOptions).filter(opt => opt.classList.contains('selected'));
                        if (selectedOptions.length === 0) {
                            const allOption = classroomFilterOptions[0];
                            allOption.classList.add('selected');
                        }
                        
                        updateFilterDisplay(classroomFilterDisplay, classroomFilterOptions, 'classroom');
                    }
                }
                
                applyFilters();
            }
            
            // Apply filters to display
            function applyFilters() {
                const allStudents = generateStudentIds();
                let filteredStudents = filterStudentIds(allStudents, currentFilters.classes);
                
                // Update total students count based on filters
                document.getElementById('totalStudents').textContent = filteredStudents.length;
                
                // Generate classrooms based on filters
                generateFilteredClassrooms(filteredStudents, currentFilters.classrooms);
                
                // Update division statistics (shows ALL divisions regardless of filters)
                generateDivisionStats(getAllArrangedStudents());
            }
            
            // Get all arranged students from displayed classrooms
            function getAllArrangedStudents() {
                const allArrangedStudents = [];
                document.querySelectorAll('.classroom-card').forEach(classroom => {
                    const seats = classroom.querySelectorAll('.seat');
                    seats.forEach(seat => {
                        const studentId = seat.getAttribute('data-student-id');
                        const division = seat.getAttribute('data-division');
                        if (studentId && division) {
                            allArrangedStudents.push({
                                id: studentId,
                                division: division
                            });
                        }
                    });
                });
                return allArrangedStudents;
            }
            
            // Generate and display filtered classrooms
            function generateFilteredClassrooms(filteredStudents, selectedClassrooms) {
                classroomContainer.innerHTML = '';
                
                const shuffledStudents = shuffleArray(filteredStudents);
                const rows = 6;
                const columns = 4;
                const seatsPerClassroom = rows * columns;
                
                let remainingStudents = [...shuffledStudents];
                let totalAssigned = 0;
                let allArrangedStudents = [];
                
                const classroomNumbers = selectedClassrooms.includes('all') ? 
                    [1, 2, 3, 4, 5, 6] : 
                    selectedClassrooms.map(num => parseInt(num));
                
                for (const classroomNum of classroomNumbers) {
                    if (remainingStudents.length === 0) break;
                    
                    const result = generateClassroomArrangement(remainingStudents, rows, columns);
                    const classroomHTML = createClassroomHTML(classroomNum, result.arrangement, rows, columns);
                    classroomContainer.appendChild(classroomHTML);
                    remainingStudents = result.remaining;
                    totalAssigned += result.arrangement.filter(seat => seat !== null).length;
                    allArrangedStudents = allArrangedStudents.concat(result.arrangement.filter(seat => seat !== null));
                }
                
                // Update assigned seats count
                document.getElementById('assignedSeats').textContent = totalAssigned;
                
                // If there are remaining students, show a message
                if (remainingStudents.length > 0) {
                    const messageDiv = document.createElement('div');
                    messageDiv.style.textAlign = 'center';
                    messageDiv.style.marginTop = '20px';
                    messageDiv.style.color = 'var(--danger-color)';
                    messageDiv.style.gridColumn = 'span 2';
                    messageDiv.innerHTML = `
                        <div class="dashboard-section">
                            <h3><span class="icon">‚ö†Ô∏è</span> Note</h3>
                            <p>${remainingStudents.length} students could not be assigned due to adjacency constraints or limited seats.</p>
                            <button class="btn btn-secondary" onclick="forceAssignRemaining()">
                                <span>‚ö°</span> Force Assign Remaining
                            </button>
                        </div>
                    `;
                    classroomContainer.appendChild(messageDiv);
                }
                
                return allArrangedStudents;
            }
            
            // Generate and display all classrooms (initial)
            function generateClassrooms() {
                applyFilters();
            }
            
            // Force assign remaining students
            window.forceAssignRemaining = function() {
                showNotification('This feature would implement a more advanced algorithm to assign remaining students, possibly relaxing adjacency constraints.', 'warning');
            }
            
            // NEW: Generate PDF of sitting arrangement
            function generatePDF() {
                // Show loading state
                const originalText = downloadPdfBtn.innerHTML;
                downloadPdfBtn.innerHTML = '<span class="loading"></span> Generating PDF...';
                downloadPdfBtn.disabled = true;
                
                setTimeout(() => {
                    // Create a temporary container for PDF content
                    const pdfContainer = document.createElement('div');
                    pdfContainer.style.width = '210mm'; // A4 width
                    pdfContainer.style.padding = '20px';
                    pdfContainer.style.backgroundColor = 'white';
                    pdfContainer.style.color = 'black';
                    
                    // Add header
                    const header = document.createElement('div');
                    header.style.textAlign = 'center';
                    header.style.marginBottom = '30px';
                    header.style.borderBottom = '2px solid #2563eb';
                    header.style.paddingBottom = '15px';
                    
                    const title = document.createElement('h1');
                    title.textContent = 'Soham - Seating Arrangement';
                    title.style.color = '#2563eb';
                    title.style.marginBottom = '10px';
                    title.style.fontSize = '28px';
                    
                    const date = document.createElement('p');
                    date.textContent = `Generated on: ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}`;
                    date.style.color = '#666';
                    date.style.fontSize = '14px';
                    
                    header.appendChild(title);
                    header.appendChild(date);
                    pdfContainer.appendChild(header);
                    
                    // Clone classroom container content
                    const classroomContainerClone = classroomContainer.cloneNode(true);
                    classroomContainerClone.style.margin = '0';
                    
                    // Update styles for PDF
                    const classroomCards = classroomContainerClone.querySelectorAll('.classroom-card');
                    classroomCards.forEach(card => {
                        card.style.boxShadow = '0 2px 5px rgba(0,0,0,0.1)';
                        card.style.marginBottom = '20px';
                        card.style.pageBreakInside = 'avoid';
                    });
                    
                    // Update seat styles for better print visibility
                    const seats = classroomContainerClone.querySelectorAll('.seat');
                    seats.forEach(seat => {
                        seat.style.boxShadow = '0 1px 3px rgba(0,0,0,0.2)';
                        seat.style.fontSize = '11px';
                        seat.style.padding = '8px 3px';
                        seat.style.minHeight = '55px';
                    });
                    
                    const seatNumbers = classroomContainerClone.querySelectorAll('.seat-number');
                    seatNumbers.forEach(seatNumber => {
                        seatNumber.style.fontSize = '10px';
                        seatNumber.style.marginBottom = '3px';
                    });
                    
                    const studentIds = classroomContainerClone.querySelectorAll('.student-id');
                    studentIds.forEach(studentId => {
                        studentId.style.fontSize = '9px';
                    });
                    
                    pdfContainer.appendChild(classroomContainerClone);
                    
                    // Add footer with page numbers
                    const footer = document.createElement('div');
                    footer.style.textAlign = 'center';
                    footer.style.marginTop = '30px';
                    footer.style.paddingTop = '15px';
                    footer.style.borderTop = '1px solid #ddd';
                    footer.style.fontSize = '12px';
                    footer.style.color = '#666';
                    footer.textContent = `Seating Arrangement - Page 1`;
                    pdfContainer.appendChild(footer);
                    
                    // Hide the PDF container from view
                    pdfContainer.style.position = 'absolute';
                    pdfContainer.style.left = '-9999px';
                    document.body.appendChild(pdfContainer);
                    
                    // Generate PDF using html2canvas and jsPDF
                    html2canvas(pdfContainer, {
                        scale: 2,
                        useCORS: true,
                        logging: false,
                        backgroundColor: '#ffffff'
                    }).then(canvas => {
                        const imgData = canvas.toDataURL('image/png');
                        const { jsPDF } = window.jspdf;
                        const pdf = new jsPDF('p', 'mm', 'a4');
                        const imgWidth = 210; // A4 width in mm
                        const pageHeight = 295; // A4 height in mm
                        const imgHeight = canvas.height * imgWidth / canvas.width;
                        
                        let heightLeft = imgHeight;
                        let position = 0;
                        
                        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                        
                        // Add additional pages if needed
                        while (heightLeft >= 0) {
                            position = heightLeft - imgHeight;
                            pdf.addPage();
                            pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                            heightLeft -= pageHeight;
                        }
                        
                        // Save the PDF
                        pdf.save('Seating_Arrangement_' + new Date().toISOString().slice(0, 10) + '.pdf');
                        
                        // Clean up
                        document.body.removeChild(pdfContainer);
                        
                        // Reset button
                        downloadPdfBtn.innerHTML = originalText;
                        downloadPdfBtn.disabled = false;
                        
                        showNotification('PDF generated and downloaded successfully!', 'success');
                    }).catch(error => {
                        console.error('Error generating PDF:', error);
                        document.body.removeChild(pdfContainer);
                        
                        // Reset button
                        downloadPdfBtn.innerHTML = originalText;
                        downloadPdfBtn.disabled = false;
                        
                        showNotification('Error generating PDF. Please try again.', 'error');
                    });
                }, 500);
            }
            
            // Clear all arrangements
            function clearAllArrangements() {
                if (confirm('Are you sure you want to clear all seating arrangements? This action cannot be undone.')) {
                    classroomContainer.innerHTML = `
                        <div style="grid-column: span 2; text-align: center; padding: 50px;">
                            <h3>No Seating Arrangement Generated</h3>
                            <p>Click "Regenerate Arrangement" to create a new seating plan.</p>
                        </div>
                    `;
                    
                    // Update assigned seats count
                    document.getElementById('assignedSeats').textContent = '0';
                    
                    // Regenerate division statistics (shows all divisions with 0 assigned)
                    generateDivisionStats([]);
                    
                    showNotification('All seating arrangements cleared.', 'success');
                }
            }
            
            // Apply filters button event
            applyFilterBtn.addEventListener('click', () => {
                applyFilters();
                showNotification('Filters applied successfully!', 'success');
            });
            
            // Clear filters button event
            clearFilterBtn.addEventListener('click', () => {
                // Reset class filter
                classFilterOptions.forEach((option, index) => {
                    option.classList.remove('selected');
                    if (index === 0) option.classList.add('selected');
                });
                updateFilterDisplay(classFilterDisplay, classFilterOptions, 'class');
                
                // Reset classroom filter
                classroomFilterOptions.forEach((option, index) => {
                    option.classList.remove('selected');
                    if (index === 0) option.classList.add('selected');
                });
                updateFilterDisplay(classroomFilterDisplay, classroomFilterOptions, 'classroom');
                
                applyFilters();
                showNotification('Filters cleared successfully!', 'success');
            });
            
            // Event listeners
            regenerateBtn.addEventListener('click', () => {
                generateClassrooms();
                showNotification('Seating arrangement generated successfully!', 'success');
            });
            
            downloadPdfBtn.addEventListener('click', generatePDF);
            clearBtn.addEventListener('click', clearAllArrangements);
            
            // Close modal when clicking outside
            document.getElementById('seatDetailsModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeSeatDetails();
                }
            });
            
            // Notification system
            function showNotification(message, type = 'info') {
                // Remove existing notification
                const existingNotification = document.querySelector('.notification');
                if (existingNotification) {
                    existingNotification.remove();
                }
                
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.innerHTML = `
                    <div class="notification-content">
                        <span class="notification-message">${message}</span>
                        <button class="notification-close" onclick="this.parentElement.parentElement.remove()">√ó</button>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // Auto remove after 3 seconds
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 3000);
            }
            
            // Logout function
            window.logout = function(event) {
                event.preventDefault();
                // Show loading state
                const logoutBtn = event.target;
                const originalText = logoutBtn.innerHTML;
                logoutBtn.innerHTML = '<span class="loading"></span> Logging out...';
                logoutBtn.disabled = true;
                
                setTimeout(() => {
                    localStorage.removeItem("isLoggedIn");
                    localStorage.removeItem("userRole");
                    window.location.href = "role-selection.html";
                }, 1000);
            };
            
            // Initial generation without notification
            generateClassrooms();
            updateSelectedFiltersDisplay();
        });
    </script>
</body>
</html>